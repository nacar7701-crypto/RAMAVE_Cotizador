@{
    ViewData["Title"] = "Usuarios";
}

<style>
    .container {
        padding: 1rem;
    }

    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    /* Estilos del buscador */
    .search-box {
        width: 100%;
        max-width: 400px;
        padding: .6rem;
        border-radius: 6px;
        border: 1px solid #ddd;
        outline: none;
    }

    .search-box:focus {
        border-color: #c62828;
        box-shadow: 0 0 5px rgba(198, 40, 40, 0.2);
    }

    .btn {
        background: #c62828;
        color: white;
        border: none;
        padding: .6rem 1rem;
        border-radius: 6px;
        cursor: pointer;
    }

    .btn:hover {
        background: #a81f1f;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
    }

    th, td {
        padding: .7rem;
        border-bottom: 1px solid #ddd;
        text-align: left;
    }

    .actions button {
        margin-right: .3rem;
    }

    @@media (max-width: 768px) {
        .header { flex-direction: column; align-items: stretch; }
        .search-box { max-width: 100%; }
        
        table, thead, tbody, tr, td, th {
            display: block;
        }

        tr {
            margin-bottom: 1rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: .5rem;
            background: white;
        }

        th { display: none; }
        
        td::before {
            content: attr(data-label);
            font-weight: bold;
            display: block;
            color: #c62828;
            font-size: 0.8rem;
            margin-bottom: 0.2rem;
        }
    }
</style>

<div class="container">
    <div class="header">
        <h2>Usuarios</h2>
        <input type="text" id="txtBuscar" class="search-box" placeholder="üîç Buscar por nombre o correo..." onkeyup="filtrarTabla()">
        <button class="btn" onclick="location.href='/UsuariosView/Create'">‚ûï Nuevo</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Correo</th>
                <th>Rol</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="tablaUsuarios"></tbody>
    </table>
</div>

<script>
    let listaUsuarios = []; // Variable global para almacenar los datos originales

    // Carga inicial de datos
    fetch('/api/usuarios')
        .then(r => r.json())
        .then(data => {
            listaUsuarios = data;
            mostrarUsuarios(listaUsuarios);
        });

    // Funci√≥n para renderizar la tabla
    function mostrarUsuarios(usuarios) {
        const tbody = document.getElementById('tablaUsuarios');
        tbody.innerHTML = ''; 

        usuarios.forEach(u => {
            tbody.innerHTML += `
            <tr>
                <td data-label="Nombre">${u.nombre}</td>
                <td data-label="Correo">${u.correo_electronico}</td>
                <td data-label="Rol">${u.rol}</td>
                <td class="actions" data-label="Acciones">
                    <button class="btn" onclick="location.href='/UsuariosView/Edit/${u.id}'" title="Editar">‚úèÔ∏è</button>
                    <button class="btn" onclick="eliminar(${u.id})" title="Eliminar">‚ùå</button>
                </td>
            </tr>`;
        });
    }

    // Funci√≥n de b√∫squeda/filtrado
    function filtrarTabla() {
        const busqueda = document.getElementById('txtBuscar').value.toLowerCase();
        
        const usuariosFiltrados = listaUsuarios.filter(u => 
            u.nombre.toLowerCase().includes(busqueda) || 
            u.correo_electronico.toLowerCase().includes(busqueda)
        );

        mostrarUsuarios(usuariosFiltrados);
    }

    function eliminar(id) {
        if (!confirm('¬øEliminar usuario?')) return;
        fetch('/api/usuarios/' + id, { method: 'DELETE' })
            .then(res => {
                if (res.ok) {
                    // Actualizar lista local sin recargar toda la p√°gina (opcional pero m√°s r√°pido)
                    listaUsuarios = listaUsuarios.filter(u => u.id !== id);
                    filtrarTabla(); 
                } else {
                    alert("Error al eliminar el usuario");
                }
            });
    }
</script>